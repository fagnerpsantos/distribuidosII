package response;

import java.io.BufferedReader;
import java.io.File;
import java.io.InputStreamReader;
import java.nio.file.Files;

public class FileResponse implements Response{

	@Override
	public String respond() {
        BufferedReader buffer = new BufferedReader(new InputStreamReader(socket.getInputStream()));


		String linha = buffer.readLine();
        //quebra a string pelo espaço em branco
        String[] dadosReq = linha.split(" ");
        //pega o metodo
        String metodo = dadosReq[0];
        //paga o caminho do arquivo
        String caminhoArquivo = dadosReq[1];
        //pega o protocolo
        String protocolo = dadosReq[2];
        //Enquanto a linha não for vazia
        while (!linha.isEmpty()) {
            //imprime a linha
            System.out.println(linha);
            //lê a proxima linha
            linha = buffer.readLine();
        }
        //se o caminho foi igual a / entao deve pegar o /index.html
        if (caminhoArquivo.equals("/")) {
            caminhoArquivo = "/index.html";
        }
        //abre o arquivo pelo caminho
        File arquivo = new File(caminhoArquivo);
        byte[] conteudo;
        //status de sucesso - HTTP/1.1 200 OK
        String status = protocolo + " 200 OK\r\n";
        //se o arquivo não existe então abrimos o arquivo de erro, e mudamos o status para 404
        if (!arquivo.exists()) {
            status = protocolo + " 404 Not Found\r\n";
            arquivo = new File("/404.html");
        }
        conteudo = Files.readAllBytes(arquivo.toPath());
		return null;
	}

}
